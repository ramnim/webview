!function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i(i.s=0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.r(t);var o=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.scene=t,this.meshes=[],this.sounds=[],this.manager=new BABYLON.AssetsManager(this.scene),this.manager.onFinish=function(e){i&&i(e)}}var t,i,o;return t=e,(i=[{key:"addSound",value:function(e,t,i){var n=this;return this.manager.addBinaryFileTask(e+"__SoundTask",t).onSuccess=function(t){n.sounds[e]=new BABYLON.Sound(e,t.data,n.scene,null,i),i.onSuccess&&i.onSuccess(n.sounds[e])},this.sounds[e]}},{key:"addMusic",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i.loop=void 0===i.loop||i.loop,i.volume=void 0!==i.volume?i.volume:.5,i.autoplay=void 0===i.autoplay||i.autoplay,this.addSound(e,t,i)}},{key:"addMesh",value:function(){}},{key:"getMesh",value:function(e){return this.meshes[e]}},{key:"getSound",value:function(e){return this.sounds[e]}},{key:"load",value:function(){this.manager.load()}}])&&n(t.prototype,i),o&&n(t,o),e}();function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentControlID=0,this.controls=[],this.menuTexture=BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI(t)}var t,i,n;return t=e,(i=[{key:"addButton",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=BABYLON.GUI.Button.CreateSimpleButton(e,t);return n.width=i.width||.5,n.height=i.height||"60px",n.color=i.color||"black",n.outlineWidth=i.outlineWidth||0,n.outlineColor=i.outlineColor||n.color,n.background=i.background||"white",n.left=i.left||"0px",n.top=i.top||"0px",n.textHorizontalAlignment=void 0!==i.horizontalAlignment?i.horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,n.textVerticalAlignment=void 0!==i.verticalAlignment?i.verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER,i.onclick&&n.onPointerUpObservable.add(i.onclick),this.menuTexture.addControl(n),this.add(n),n}},{key:"addText",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new BABYLON.GUI.TextBlock;return i.text=e,i.color=t.color||"white",i.fontSize=t.fontSize||28,i.outlineWidth=t.outlineWidth||0,i.outlineColor=t.outlineColor||"black",i.lineSpacing=t.lineSpacing||"5px",i.left=t.left||"0px",i.top=t.top||"0px",i.textHorizontalAlignment=void 0!==t.horizontalAlignment?t.horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER,i.textVerticalAlignment=void 0!==t.verticalAlignment?t.verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP,i.textWrapping=t.wrapping||!0,this.menuTexture.addControl(i),this.add(i),i}},{key:"add",value:function(e){e.uiControlID=this.currentControlID++,this.controls.push(e)}},{key:"remove",value:function(e){e.isVisible=!1,this.controls.splice(e.uiControlID,1)}},{key:"show",value:function(){this.controls.forEach(function(e){return e.isVisible=!0})}},{key:"hide",value:function(){this.controls.forEach(function(e){return e.isVisible=!1})}}])&&s(t.prototype,i),n&&s(t,n),e}();function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.level=t,this.scene=t.scene,this.statuses={RUNNING:!0,JUMPING:!1,DRAGGING:!1,FALLING_DOWN:!1,SLOW:!1,DEAD:!1},this.coinsTextControl=null,this.metersTextControl=null,this.dieSound=null,this.jumpSound=null,this.damageSound=null,this.gotCoinSound=null,this.godMode=!1,this.defaultSpeed=GAME.options.player.defaultSpeed,this.speed=this.defaultSpeed,this.gravity=GAME.options.player.gravity,this.jumpForce=GAME.options.player.jumpForce,this.jumpMaxAltitude=GAME.options.player.jumpMaxAltitude,this.defaultAltitude=.25,this.lastAltitude=this.defaultAltitude,this.coins=0,this.points=0,this.pointsRecord=!1,this.damages=0,this.onDie=null,this.travelledDistance=0,this.totalTravelledDistance=0,this.setupPlayer()}var t,i,n;return t=e,(i=[{key:"setupPlayer",value:function(){this.dieSound=this.level.assets.getSound("playerDieSound"),this.gotCoinSound=this.level.assets.getSound("gotCoinSound"),this.damageSound=this.level.assets.getSound("damageSound"),this.mesh=BABYLON.MeshBuilder.CreateBox("player",{width:.3333333,height:.5,depth:.3333333},this.scene),this.mesh.position.y=this.defaultAltitude;var e=new BABYLON.StandardMaterial("playerMaterial",this.scene);e.diffuseColor=new BABYLON.Color3.FromHexString(GAME.options.playerColor),this.mesh.material=e,this.mesh.setEllipsoidPerBoundingBox(),this.setupAnimations(),this.createHUD()}},{key:"setupAnimations",value:function(){var e=new BABYLON.Animation("blinkAnimation","material.alpha",120,BABYLON.Animation.ANIMATIONTYPE_FLOAT,BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE),t=[];t.push({frame:0,value:1}),t.push({frame:15,value:.2}),t.push({frame:30,value:1}),e.setKeys(t),this.mesh.animations=[],this.mesh.animations.push(e)}},{key:"createHUD",value:function(){this.hud=new r("playerHudUI"),this.metersTextControl=this.hud.addText("Meters: 0",{top:"10px",left:"10px",horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT}),this.coinsTextControl=this.hud.addText("Coins: 0",{top:"10px",left:"-10px",horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT})}},{key:"getMesh",value:function(){return this.mesh}},{key:"damage",value:function(){var e=this;this.damages++,this.damageSound.play(),this.blink(),this.speed=this.defaultSpeed/2,this.statuses.SLOW=!0,setTimeout(function(){e.statuses.SLOW=!1,e.speed=e.defaultSpeed},1500)}},{key:"blink",value:function(){var e=this,t=this.scene.beginAnimation(this.mesh,0,30,!0);setTimeout(function(){t.pause(),e.mesh.material.alpha=1},1500)}},{key:"move",value:function(){if(!this.statuses.DEAD){var e=this.scene.getAnimationRatio()/50,t=this.godMode?0:this.gravity*e,i=this.statuses.JUMPING&&!this.statuses.FALLING_DOWN?this.jumpForce*e:0,n=this.speed*e;n*=this.statuses.JUMPING?1.5:1,this.mesh.moveWithCollisions(new BABYLON.Vector3(0,t+i,n)),this.checkPlayerLateralMovement(e),this.calculateTravelledDistance(e),this.checkPlayerJump(),this.checkPlayerAltitude(),this.checkPlayerDragging(),this.mesh.position.y<=-2&&!this.statuses.DEAD&&this.die()}}},{key:"calculateTravelledDistance",value:function(e){this.travelledDistance>=100&&(this.travelledDistance=0),this.travelledDistance+=this.speed*e,this.totalTravelledDistance+=this.speed*e,this.metersTextControl.text="Meters: "+Math.floor(this.totalTravelledDistance)}},{key:"checkPlayerAltitude",value:function(){this.mesh.position.y<this.lastAltitude?this.statuses.FALLING_DOWN=!0:this.statuses.FALLING_DOWN=!1,this.lastAltitude=this.mesh.position.y}},{key:"checkPlayerLateralMovement",value:function(e){!GAME.keys.left||this.statuses.JUMPING||this.statuses.FALLING_DOWN||(this.mesh.position.x-=this.speed/5*e),!GAME.keys.right||this.statuses.JUMPING||this.statuses.FALLING_DOWN||(this.mesh.position.x+=this.speed/5*e)}},{key:"checkPlayerJump",value:function(){!GAME.keys.up||this.statuses.JUMPING||this.statuses.FALLING_DOWN||(this.statuses.JUMPING=!0),this.mesh.position.y>=this.jumpMaxAltitude&&this.statuses.JUMPING&&(this.lastAltitude=this.lastAltitude+100,this.statuses.FALLING_DOWN=!0,this.statuses.JUMPING=!1)}},{key:"checkPlayerDragging",value:function(){var e=this;GAME.keys.down?this.statuses.DRAGGING||(this.statuses.DRAGGING=!0,this.speed=1.5*this.defaultSpeed,this.level.interpolate(this.mesh.scaling,"y",.5,100,function(){e.mesh.ellipsoid.y=.125}),setTimeout(function(){e.statuses.DRAGGING=!1,e.mesh.ellipsoid.y=.25,e.level.interpolate(e.mesh.scaling,"y",1,100)},700)):this.statuses.DRAGGING||(this.statuses.JUMPING||this.statuses.FALLING_DOWN||(this.mesh.position.y=this.defaultAltitude),this.statuses.SLOW||(this.speed=this.defaultSpeed))}},{key:"getTravelledDistance",value:function(){return this.travelledDistance}},{key:"keepCoin",value:function(){this.coins++,this.coinsTextControl.text="Coins: "+this.coins,this.gotCoinSound.play()}},{key:"reset",value:function(){this.statuses.DEAD=!1,this.statuses.JUMPING=!1,this.statuses.FALLING_DOWN=!1,this.statuses.DRAGGING=!1,this.coins=0,this.damages=0,this.mesh.position.x=0,this.mesh.position.y=this.defaultAltitude,this.mesh.position.z=0,this.travelledDistance=0,this.totalTravelledDistance=0}},{key:"die",value:function(){this.godMode||(this.statuses.DEAD=!0,this.dieSound.play(),this.onDie&&this.onDie())}},{key:"getPoints",value:function(){return this.points}},{key:"calculatePoints",value:function(){return this.points=0,this.points+=10*this.coins,this.points+=this.totalTravelledDistance,this.points-=5*this.damages,this.points=this.points>0?this.points.toFixed(0):0,this.checkAndSaveRecord(this.points),this.points}},{key:"checkAndSaveRecord",value:function(e){var t=0;this.pointsRecord=!1,window.localStorage.last_record&&(t=parseInt(window.localStorage.last_record,10)),t<e&&(this.pointsRecord=!0,window.localStorage.last_record=e)}},{key:"hasMadePointsRecord",value:function(){return this.pointsRecord}},{key:"getLastRecord",value:function(){return window.localStorage.last_record||0}}])&&a(t.prototype,i),n&&a(t,n),e}();function u(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.level=t,this.player=t.player,this.currentPlayerTravelledDistance=0,this.distanceBeetweenPlayer=.9,this.statuses={CLOSE_TO_PLAYER:!0},this.approachSound=null,this.attackSound=null,this.scene=t.scene,this.mesh=BABYLON.MeshBuilder.CreateSphere("monsterSphere",{diameter:.25,segments:2},this.scene),this.mesh.position.x=0,this.mesh.position.y=.2,this.mesh.position.z=this.player.mesh.position.z-this.distanceBeetweenPlayer,this.monsterMaterial=new BABYLON.StandardMaterial("monsterMaterial",this.scene),this.monsterMaterial.diffuseColor=new BABYLON.Color3.FromHexString(GAME.options.monsterColor),this.monsterMaterial.specularColor=new BABYLON.Color3(0,0,0),this.mesh.material=this.monsterMaterial,this.approachSound=this.level.assets.getSound("approachSound"),this.attackSound=this.level.assets.getSound("attackSound")}var t,i,n;return t=e,(i=[{key:"approachToPlayer",value:function(){this.statuses.CLOSE_TO_PLAYER=!0,this.currentPlayerTravelledDistance=this.player.totalTravelledDistance,this.level.interpolate(this,"distanceBeetweenPlayer",.9,500),this.approachSound.play()}},{key:"moveAwayFromPlayer",value:function(){this.statuses.CLOSE_TO_PLAYER=!1,this.level.interpolate(this,"distanceBeetweenPlayer",1.5,1500)}},{key:"attackPlayer",value:function(){var e=this;this.attackSound.play(),this.level.interpolate(this,"distanceBeetweenPlayer",.1,300),setTimeout(function(){return e.player.die()},300)}},{key:"move",value:function(){this.scene.getAnimationRatio();this.mesh.position.x=this.player.mesh.position.x,this.mesh.position.y=Math.sin(this.mesh.position.z)/100+.2+(this.player.mesh.position.y-this.player.defaultAltitude),this.mesh.position.z=this.player.mesh.position.z-this.distanceBeetweenPlayer,this.player.totalTravelledDistance-this.currentPlayerTravelledDistance>100&&this.statuses.CLOSE_TO_PLAYER&&this.moveAwayFromPlayer()}},{key:"isCloseToPlayer",value:function(){return this.statuses.CLOSE_TO_PLAYER}}])&&u(t.prototype,i),n&&u(t,n),e}();function c(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var d=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentID=0,this.logs=[],this.enabled=t}var t,i,n;return t=e,(i=[{key:"push",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.enabled&&(e.ID=++this.currentID,this.logs.push(e))}},{key:"doing",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.push({doing:e})}},{key:"getLast",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.logs.slice(-e)}},{key:"logLast",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;console.log(this.getLast(e))}},{key:"get",value:function(){return this.logs}},{key:"log",value:function(){console.log(this.logs)}},{key:"debug",value:function(e){GAME.options.debugMode&&console.log("DEBUG LOG: "+e)}},{key:"debugWarning",value:function(e){GAME.options.debugMode&&console.warn("DEBUG LOG: "+e)}},{key:"debugError",value:function(e){GAME.options.debugMode&&console.error("DEBUG LOG: "+e)}}])&&c(t.prototype,i),n&&c(t,n),e}();function p(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.materials={},this.scene=null,this.assets=null}var t,i,n;return t=e,(i=[{key:"start",value:function(){GAME.resume(),GAME.stopRenderLoop(),this.setProperties?this.setProperties():GAME.log.debugWarning("The setProperties method is recommended to initialize the Level properties"),this.createScene()}},{key:"createScene",value:function(){var e=this;return this.scene=new BABYLON.Scene(GAME.engine),this.assets=new o(this.scene,function(){GAME.log.debug("Level Assets loaded"),e.buildScene?e.buildScene():GAME.log.debugWarning("You can add the buildScene method to your level to define your scene"),e.beforeRender?e.scene.registerBeforeRender(e.beforeRender.bind(e)):GAME.log.debugWarning("You can define animations and other game logics that happends inside the main loop on the beforeRender method"),GAME.startRenderLoop()}),this.setupAssets&&this.setupAssets(),this.assets.load(),this.scene}},{key:"exit",value:function(){this.scene.dispose(),this.scene=null}},{key:"addCollider",value:function(e,t){var i=BABYLON.MeshBuilder.CreateBox(e,{width:t.width||1,height:t.height||1,depth:t.depth||1},this.scene);if(BABYLON.Tags.AddTagsTo(i,"collider boxCollider"),i.position.x=t.positionX||0,i.position.y=t.positionY||0,i.position.z=t.positionZ||0,i.isVisible=!!t.visible&&t.visible,i.isVisible){var n=new BABYLON.StandardMaterial(e+"Material");n.diffuseColor=new BABYLON.Color3(.5,.5,0),n.alpha=.5,i.material=n}return t.timeToDispose=t.timeToDispose?t.timeToDispose:0,i.actionManager=new BABYLON.ActionManager(this.scene),i.actionManager.registerAction(new BABYLON.ExecuteCodeAction({trigger:BABYLON.ActionManager.OnIntersectionEnterTrigger,parameter:t.collisionMesh},function(){t.onCollide&&t.onCollide(),t.disposeAfterCollision&&setTimeout(function(){i.dispose()},t.timeToDispose)})),i}},{key:"disposeColliders",value:function(){for(var e=this.scene.getMeshesByTags("collider"),t=0;t<e.length;t++)e[t].dispose()}},{key:"addMaterial",value:function(e){this.materials[e.name]=e}},{key:"getMaterial",value:function(e){return this.materials[e]}},{key:"removeMaterial",value:function(e){var t=null;(t=this.materials[e])&&(t.dispose(),delete this.materials[e])}},{key:"interpolate",value:function(e,t,i,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.scene.actionManager||(this.scene.actionManager=new BABYLON.ActionManager(this.scene));var s=new BABYLON.InterpolateValueAction(BABYLON.ActionManager.NothingTrigger,e,t,i,n);s.onInterpolationDoneObservable.add(function(){GAME.log.debug("Interpolation done"),o&&o()}),this.scene.actionManager.registerAction(s),s.execute()}}])&&p(t.prototype,i),n&&p(t,n),e}();function y(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.level=t,this.scene=t.scene,this.player=t.player,this.monster=t.monster,this.tileDepth=10,this.maxTilesAtTime=20,this.lastTileType="HOLE",this.generatedTilesNumber=0,this.generatedTilesBlocksNumber=0,this.createCommonMaterials()}var t,i,n;return t=e,(i=[{key:"createCommonMaterials",value:function(){var e=new BABYLON.StandardMaterial("coinMaterial",this.scene);e.diffuseColor=new BABYLON.Color3.FromHexString(GAME.options.coinColor),e.emissiveColor=new BABYLON.Color3.FromHexString(GAME.options.coinColor);var t=new BABYLON.StandardMaterial("tileMaterialLight",this.scene);t.diffuseColor=new BABYLON.Color3.FromHexString(GAME.options.tileLightColor);var i=new BABYLON.StandardMaterial("tileMaterialDark",this.scene);i.diffuseColor=new BABYLON.Color3.FromHexString(GAME.options.tileDarkColor);var n=new BABYLON.StandardMaterial("hazardMaterial",this.scene);n.diffuseColor=new BABYLON.Color3.FromHexString(GAME.options.hazardColor),n.alpha=.6,e.freeze(),t.freeze(),i.freeze(),n.freeze(),this.level.addMaterial(e),this.level.addMaterial(t),this.level.addMaterial(i),this.level.addMaterial(n)}},{key:"generate",value:function(){var e=this;this.generatedTilesBlocksNumber+=1;for(var t=1;t<=this.maxTilesAtTime;t++){this.generatedTilesNumber+=1;var i={width:100,height:100,visible:!1,disposeAfterCollision:!0,collisionMesh:this.player.getMesh(),positionZ:(this.generatedTilesNumber-1)*this.tileDepth};if(1==t&&1!=this.generatedTilesNumber){var n=Object.assign({},i);n.onCollide=function(){e.disposeOldTiles()},this.level.addCollider("deleteOldTilesCollider",n)}if(10==t){var o=Object.assign({},i);o.onCollide=function(){e.generate()},this.level.addCollider("generateMoreTilesCollider",o)}this.createTiles()}}},{key:"createTiles",value:function(){var e=["NORMAL_GROUND","SMALL_GROUND","NORMAL_GROUND","NORMAL_GROUND","GROUND_WITH_TOTAL_OBSTACLE","HOLE","NORMAL_GROUND","NORMAL_GROUND","GROUND_WITH_TOTAL_OBSTACLE","NORMAL_GROUND","GROUND_WITH_HIGH_OBSTACLE","HOLE","SMALL_GROUND"],t="NORMAL_GROUND";this.generatedTilesNumber>20&&(t=e[Math.floor(Math.random()*e.length)]);"NORMAL_GROUND"!=this.lastTileType&&"NORMAL_GROUND"!=t&&(t="NORMAL_GROUND"),this.lastTileType=t,"NORMAL_GROUND"==t&&this.createNormalGroundTile(),"SMALL_GROUND"==t&&this.createSmallGroundTile(),"GROUND_WITH_TOTAL_OBSTACLE"==t&&this.createTileWithObstacleTile(),"GROUND_WITH_HIGH_OBSTACLE"==t&&this.createTileWithHighObstacleTile()}},{key:"createTile",value:function(e){e=e||{width:GAME.options.level.tileWidth,height:1,depth:this.tileDepth};var t=BABYLON.MeshBuilder.CreateBox("groundTile"+this.generatedTilesNumber,e,this.scene);return BABYLON.Tags.AddTagsTo(t,"tilesBlock tilesBlock"+this.generatedTilesBlocksNumber),t.receiveShadows=!0,t.position.z=(this.generatedTilesNumber-1)*this.tileDepth,t.position.y=-.5,t.checkCollisions=!0,t.material=this.generatedTilesNumber%2==0?this.level.getMaterial("tileMaterialLight"):this.level.getMaterial("tileMaterialDark"),t}},{key:"createCoins",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.position.x;if(i){var o=Math.floor(100*Math.random());o<=33&&(n=-.3333),o>=66&&(n=.3333)}for(var s=function(){var i=BABYLON.MeshBuilder.CreateBox("coin"+r+t.generatedTilesNumber,{width:.1,height:.1,depth:.1},t.scene);BABYLON.Tags.AddTagsTo(i,"tilesBlock tilesBlock"+t.generatedTilesBlocksNumber),i.material=t.level.getMaterial("coinMaterial"),i.position.x=n,i.position.z=e.position.z-t.tileDepth/2+2*r,i.position.y=.3;var o=t.player.getMesh();i.executeOnIntersection(o,function(){t.player.keepCoin(),t.level.interpolate(i.position,"y",10,500)},!0)},r=0;r<5;r++)s()}},{key:"createNormalGroundTile",value:function(){var e=this.createTile();Math.floor(100*Math.random())>40&&this.createCoins(e,!0)}},{key:"createSmallGroundTile",value:function(){var e=this.createTile({width:GAME.options.level.smallTileWidth,height:1,depth:this.tileDepth}),t=Math.floor(100*Math.random()+1);e.position.x=t<=50?-.3333:.3333,e.position.y=-.5,this.createCoins(e)}},{key:"createTileWithObstacleTile",value:function(){var e=this,t=this.createTile(),i=BABYLON.MeshBuilder.CreateBox("obstacleTile"+this.generatedTilesNumber,{width:GAME.options.level.hazardWidth,height:.05,depth:8.25},this.scene);BABYLON.Tags.AddTagsTo(i,"tilesBlock tilesBlock"+this.generatedTilesBlocksNumber),i.position.z=t.position.z,i.position.y=.0025,i.material=this.level.getMaterial("hazardMaterial");var n=this.player.getMesh();i.executeOnIntersection(n,function(){e.player.damage(),e.monster.isCloseToPlayer()?e.monster.attackPlayer():e.monster.approachToPlayer()},!0)}},{key:"createTileWithHighObstacleTile",value:function(e){var t=this,i=this.createTile(e),n=BABYLON.MeshBuilder.CreateBox("obstacleTile"+this.generatedTilesNumber,{width:2,height:2,depth:.25},this.scene);BABYLON.Tags.AddTagsTo(n,"tilesBlock tilesBlock"+this.generatedTilesBlocksNumber),n.position.z=i.position.z,n.position.y=1.5,this.createCoins(i,!0);var o=this.player.getMesh();n.executeOnIntersection(o,function(){return t.player.die()},!0)}},{key:"disposeOldTiles",value:function(){for(var e=this.generatedTilesBlocksNumber-1,t=this.scene.getMeshesByTags("tilesBlock"+e),i=0;i<t.length;i++)t[i].dispose()}},{key:"disposeAll",value:function(){for(var e=this.scene.getMeshesByTags("tilesBlock"),t=0;t<e.length;t++)e[t].dispose()}},{key:"reset",value:function(){this.disposeAll(),this.lastTileType="HOLE",this.generatedTilesNumber=0}}])&&y(t.prototype,i),n&&y(t,n),e}();function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function A(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var L=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),A(this,T(t).apply(this,arguments))}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(t,f),i=t,(n=[{key:"setProperties",value:function(){this.player=null,this.monster=null,this.tiles=null,this.menu=null,this.pointsTextControl=null,this.currentRecordTextControl=null,this.hasMadeRecordTextControl=null}},{key:"setupAssets",value:function(){this.assets.addMusic("music","/assets/musics/Guitar-Mayhem.mp3"),this.assets.addSound("playerDieSound","/assets/sounds/game-die.mp3",{volume:.4}),this.assets.addSound("gotCoinSound","/assets/sounds/coin-c-09.wav"),this.assets.addSound("damageSound","/assets/sounds/damage.wav"),this.assets.addSound("approachSound","/assets/sounds/monster.wav"),this.assets.addSound("attackSound","/assets/sounds/monster_attack.mp3")}},{key:"buildScene",value:function(){this.scene.clearColor=new BABYLON.Color3.FromHexString(GAME.options.backgroundColor),this.createMenus();var e=this.createArcCamera();this.scene.activeCamera=e;var t=new BABYLON.HemisphericLight("light1",new BABYLON.Vector3(0,10,0),this.scene),i=new BABYLON.PointLight("light2",new BABYLON.Vector3(0,100,-100),this.scene);t.intensity=.9,i.intensity=.2,this.createPlayer(),this.createMonster(),this.tiles=new v(this),this.tiles.generate(),this.scene.debugLayer.hide(),this.scene.debugLayer.show({popup:!0})}},{key:"createMenus",value:function(){var e=this;this.menu=new r("runnerMenuUI"),this.pointsTextControl=this.menu.addText("Points: 0",{top:"-150px",color:GAME.options.pointsTextColor,outlineColor:GAME.options.pointsOutlineTextColor,outlineWidth:"2px",fontSize:"40px",verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER}),this.currentRecordTextControl=this.menu.addText("Current Record: 0",{top:"-100px",verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER}),this.hasMadeRecordTextControl=this.menu.addText("You got a new Points Record!",{top:"-60px",color:GAME.options.recordTextColor,fontSize:"20px",verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER}),this.menu.addButton("replayButton","Replay Game",{onclick:function(){return e.replay()}}),this.menu.addButton("backButton","Return to Home",{top:"70px",onclick:function(){return GAME.goToLevel("HomeMenuLevel")}}),this.menu.hide(),this.createTutorialText()}},{key:"createTutorialText",value:function(){var e=this,t=GAME.isMobile()?"Swipe the screen to control de cube":"Use Arrow Keys or WASD to control the cube",i=this.menu.addText(t,{verticalAlignment:BABYLON.GUI.Control.VERTICAL_ALIGNMENT_CENTER});setTimeout(function(){e.menu.remove(i)},5e3)}},{key:"createArcCamera",value:function(){var e=new BABYLON.ArcRotateCamera("arcCamera",0,0,0,BABYLON.Vector3.Zero(),this.scene);return e.ctype=1,e.setPosition(new BABYLON.Vector3(0,1,-3)),e.radius=2,e}},{key:"createPlayer",value:function(){var e=this;this.player=new l(this),this.scene.activeCamera.lockedTarget=this.player.getMesh();var t=new BABYLON.DirectionalLight("playerLight",new BABYLON.Vector3(1,-2,1),this.scene);t.intensity=.3,t.parent=this.player.mesh,this.scene.shadowGenerator=new BABYLON.ShadowGenerator(32,t),this.scene.shadowGenerator.useBlurExponentialShadowMap=!0,this.scene.shadowGenerator.getShadowMap().renderList.push(this.player.mesh),this.player.onDie=function(){GAME.pause(),e.player.calculatePoints(),e.showMenu()}}},{key:"showMenu",value:function(){this.pointsTextControl.text="Points: "+this.player.getPoints(),this.currentRecordTextControl.text="Current Record: "+this.player.getLastRecord(),this.menu.show(),this.player.hasMadePointsRecord()?this.hasMadeRecordTextControl.isVisible=!0:this.hasMadeRecordTextControl.isVisible=!1}},{key:"createMonster",value:function(){this.monster=new h(this),this.scene.shadowGenerator.getShadowMap().renderList.push(this.monster.mesh)}},{key:"beforeRender",value:function(){GAME.isPaused()||(this.player.move(),this.monster.move())}},{key:"replay",value:function(){this.tiles.reset(),this.disposeColliders(),this.player.reset(),this.monster.approachToPlayer(),this.tiles.generate(),this.menu.hide(),GAME.resume()}}])&&g(i.prototype,n),o&&g(i,o),t}();function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function B(e,t){return!t||"object"!==k(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),B(this,M(t).apply(this,arguments))}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(t,f),i=t,(n=[{key:"setupAssets",value:function(){this.assets.addMusic("music","/assets/musics/Guitar-Mayhem.mp3")}},{key:"buildScene",value:function(){new BABYLON.FreeCamera("camera1",new BABYLON.Vector3(0,5,-10),this.scene);this.scene.clearColor=new BABYLON.Color4(0,0,0,0),this.makeUI()}},{key:"makeUI",value:function(){var e=new r("creditsUI");e.addText("Design and Code by Tiago Silva Pereira Rodrigues\nkingofcode.com.br\n\n\n",{top:"30px",fontSize:"20px",horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_TOP}),e.addText("Music by Eric Matyas\nwww.soundimage.org\n\nPlease check the game license documentation before\nchanging the credits",{top:"140px",fontSize:"20px",horizontalAlignment:BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_TOP}),e.addButton("backButton","Return to Home",{top:"220px",background:GAME.options.backgroundColor,color:"white",onclick:function(){return GAME.goToLevel("HomeMenuLevel")}})}}])&&b(i.prototype,n),o&&b(i,o),t}();function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function E(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),E(this,S(t).apply(this,arguments))}var i,n,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}(t,f),i=t,(n=[{key:"setupAssets",value:function(){this.assets.addMusic("music","/assets/musics/Guitar-Mayhem.mp3")}},{key:"buildScene",value:function(){new BABYLON.FreeCamera("camera1",new BABYLON.Vector3(0,5,-10),this.scene);this.scene.clearColor=new BABYLON.Color4(0,0,0,0);var e=new r("homeMenuUI");e.addButton("playButton","Play Game",{background:GAME.options.backgroundColor,color:"white",onclick:function(){return GAME.goToLevel("RunnerLevel")}}),e.addButton("creditsButton","Credits",{top:"70px",background:GAME.options.backgroundColor,color:"white",onclick:function(){return GAME.goToLevel("CreditsLevel")}})}}])&&G(i.prototype,n),o&&G(i,o),t}();function R(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var P=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.keys={},this.paused=!1,this.log=new d,this.canvas=document.getElementById("renderCanvas"),this.engine=new BABYLON.Engine(this.canvas,!0),this.currentLevel=null,this.currentLevelName="HomeMenuLevel",this.levels={HomeMenuLevel:new _,CreditsLevel:new w,RunnerLevel:new L}}var t,i,n;return t=e,(i=[{key:"start",value:function(){this.listenKeys(),this.lintenTouchEvents(),this.listenOtherEvents(),this.startLevel()}},{key:"pause",value:function(){this.paused=!0}},{key:"isPaused",value:function(){return this.paused}},{key:"resume",value:function(){this.paused=!1}},{key:"listenKeys",value:function(){document.addEventListener("keydown",function(e){87==e.keyCode||38==e.keyCode?this.keys.up=1:83==e.keyCode||40==e.keyCode?this.keys.down=1:65==e.keyCode||37==e.keyCode?this.keys.left=1:68!=e.keyCode&&39!=e.keyCode||(this.keys.right=1)}.bind(this)),document.addEventListener("keyup",function(e){87==e.keyCode||38==e.keyCode?this.keys.up=0:83==e.keyCode||40==e.keyCode?this.keys.down=0:65==e.keyCode||37==e.keyCode?this.keys.left=0:68!=e.keyCode&&39!=e.keyCode||(this.keys.right=0)}.bind(this)),this.keys.up=!1,this.keys.down=!1,this.keys.left=!1,this.keys.right=!1}},{key:"lintenTouchEvents",value:function(){var e=this,t=new Hammer(document.body);t.get("swipe").set({direction:Hammer.DIRECTION_ALL}),t.on("swipeup",function(t){e.keys.up=1,setTimeout(function(){e.keys.up=0},150)}),t.on("swipedown",function(t){e.keys.down=1,setTimeout(function(){e.keys.down=0},100)}),t.on("swipeleft",function(t){e.keys.left=2,setTimeout(function(){e.keys.left=0},150)}),t.on("swiperight",function(t){e.keys.right=2,setTimeout(function(){e.keys.right=0},150)})}},{key:"listenOtherEvents",value:function(){var e=this;window.addEventListener("blur",function(){e.pause()}),window.addEventListener("focus",function(){e.resume()})}},{key:"goToLevel",value:function(e){this.levels[e]?(this.currentLevel&&this.currentLevel.exit(),this.currentLevelName=e,this.startLevel()):console.error("A level with name "+e+" does not exists")}},{key:"startLevel",value:function(){this.currentLevel=this.levels[this.currentLevelName],this.currentLevel.start()}},{key:"render",value:function(){var e=this;this.startRenderLoop(),window.addEventListener("resize",function(){e.engine.resize()})}},{key:"startRenderLoop",value:function(){var e=this;this.engine.runRenderLoop(function(){e.currentLevel.scene.render()})}},{key:"stopRenderLoop",value:function(){this.engine.stopRenderLoop()}},{key:"isMobile",value:function(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}}])&&R(t.prototype,i),n&&R(t,n),e}();window.GAME=null;var D=function(){GAME=new P(window.initialGameOptions),GAME.start()};window.addEventListener("load",function(){D()})}]);